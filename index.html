<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>Paul — Artisan Multiservice</title>
    
    <!-- Мета-теги для темы - КРИТИЧНО ДЛЯ SAFARI -->
    <meta name="color-scheme" content="light dark">
    <meta name="supported-color-schemes" content="light dark">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a2e1f" id="theme-color" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#F9F7F2" id="theme-color-light" media="(prefers-color-scheme: light)">
    
    <link rel="icon" type="image/png" href="logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* === CSS ПЕРЕМЕННЫЕ - АВТОМАТИЧЕСКАЯ ТЕМА === */
        :root {
            --dark-green: #0a2e1f;
            --gold: #d4af37;
            --gold-light: #f4d06f;
            --white: #ffffff;
        }

        /* Светлая тема по умолчанию */
        :root {
            --bg-color: #F9F7F2;
            --text-color: #0a2e1f;
            --card-bg: #ffffff;
            --border-color: #d4af37;
            --nav-bg: rgba(249, 247, 242, 0.95);
            --shadow: 0 10px 30px rgba(10, 46, 31, 0.08);
            --gold-glow: 0 4px 15px rgba(10, 46, 31, 0.1);
            --input-bg: #f0ede4;
            --input-color: #b08d1a;
            --option-bg: #ffffff;
            --qr-color: #000000;
            --qr-bg: #ffffff;
            --overlay-bg: rgba(0, 0, 0, 0.5);
            --fab-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* Темная тема через системный media query */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #0a2e1f;
                --text-color: #ffffff;
                --card-bg: rgba(255,255,255,0.06);
                --border-color: rgba(212,175,55,0.5);
                --nav-bg: rgba(10,46,31,0.95);
                --shadow: none;
                --gold-glow: 0 0 20px rgba(212, 175, 55, 0.4);
                --input-bg: rgba(255,255,255,0.05);
                --input-color: #d4af37;
                --option-bg: #0a2e1f;
                --qr-color: #ffffff;
                --qr-bg: #1e1e1e;
                --overlay-bg: rgba(0, 0, 0, 0.7);
                --fab-shadow: 0 4px 10px rgba(0,0,0,0.3);
            }
        }

        /* Темная тема через JavaScript */
        :root[data-theme="dark"] {
            --bg-color: #0a2e1f;
            --text-color: #ffffff;
            --card-bg: rgba(255,255,255,0.06);
            --border-color: rgba(212,175,55,0.5);
            --nav-bg: rgba(10,46,31,0.95);
            --shadow: none;
            --gold-glow: 0 0 20px rgba(212, 175, 55, 0.4);
            --input-bg: rgba(255,255,255,0.05);
            --input-color: #d4af37;
            --option-bg: #0a2e1f;
            --qr-color: #ffffff;
            --qr-bg: #1e1e1e;
            --overlay-bg: rgba(0, 0, 0, 0.7);
            --fab-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* Светлая тема через JavaScript */
        :root[data-theme="light"] {
            --bg-color: #F9F7F2;
            --text-color: #0a2e1f;
            --card-bg: #ffffff;
            --border-color: #d4af37;
            --nav-bg: rgba(249, 247, 242, 0.95);
            --shadow: 0 10px 30px rgba(10, 46, 31, 0.08);
            --gold-glow: 0 4px 15px rgba(10, 46, 31, 0.1);
            --input-bg: #f0ede4;
            --input-color: #b08d1a;
            --option-bg: #ffffff;
            --qr-color: #000000;
            --qr-bg: #ffffff;
            --overlay-bg: rgba(0, 0, 0, 0.5);
            --fab-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* === FIX ДЛЯ iOS SAFARI === */
        @supports (-webkit-touch-callout: none) {
            body {
                -webkit-tap-highlight-color: transparent;
                -webkit-font-smoothing: antialiased;
            }
            
            input, select, textarea {
                font-size: 16px !important;
            }
        }

        /* === ПРЕМИУМ КНОПКА ПЕРЕКЛЮЧЕНИЯ ТЕМЫ === */
        .premium-theme-toggle {
            width: 52px !important;
            height: 52px !important;
            background: var(--gold) !important;
            border: 2px solid var(--gold) !important;
            box-shadow: 
                0 8px 25px rgba(212, 175, 55, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 0 0 2px rgba(212, 175, 55, 0.1) !important;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1) !important;
            overflow: visible !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 0 !important;
            top: 15px !important;
            right: 15px !important;
            z-index: 1100 !important;
        }

        .premium-theme-toggle:hover {
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 
                0 12px 35px rgba(212, 175, 55, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 0 0 4px rgba(212, 175, 55, 0.15) !important;
        }

        .premium-theme-toggle:active {
            transform: translateY(1px) scale(0.98) !important;
            transition: all 0.2s ease !important;
        }

        .theme-toggle-inner {
            position: relative;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.1),
                0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sun-icon, .moon-icon {
            position: absolute;
            font-size: 14px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: scale(0.5);
        }

        .sun-icon {
            color: #f59e0b;
            text-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }

        .moon-icon {
            color: #1e293b;
            text-shadow: 0 0 10px rgba(30, 41, 59, 0.5);
        }

        /* Светлая тема */
        [data-theme="light"] .sun-icon {
            opacity: 1;
            transform: scale(1) rotate(20deg);
        }

        [data-theme="light"] .moon-icon {
            opacity: 0;
            transform: scale(0.5) rotate(-90deg);
        }

        [data-theme="light"] .theme-toggle-inner {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.05),
                0 4px 12px rgba(245, 158, 11, 0.25);
        }

        /* Темная тема */
        [data-theme="dark"] .sun-icon {
            opacity: 0;
            transform: scale(0.5) rotate(90deg);
        }

        [data-theme="dark"] .moon-icon {
            opacity: 1;
            transform: scale(1) rotate(-20deg);
        }

        [data-theme="dark"] .theme-toggle-inner {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            box-shadow: 
                inset 0 2px 4px rgba(255, 255, 255, 0.05),
                0 4px 12px rgba(30, 41, 59, 0.5);
        }

        /* Auto тема */
        [data-theme="auto"] .theme-toggle-inner {
            background: conic-gradient(from 0deg, #f59e0b, #d4af37, #1e293b, #d4af37, #f59e0b);
            animation: rotateGradient 10s linear infinite;
        }

        [data-theme="auto"] .sun-icon,
        [data-theme="auto"] .moon-icon {
            opacity: 0.7;
            transform: scale(0.8);
            animation: gentlePulse 3s ease-in-out infinite;
        }

        .theme-toggle-slider {
            position: absolute;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid transparent;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="light"] .theme-toggle-slider {
            border-color: rgba(245, 158, 11, 0.3);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }

        [data-theme="dark"] .theme-toggle-slider {
            border-color: rgba(30, 41, 59, 0.5);
            box-shadow: 0 0 20px rgba(30, 41, 59, 0.5);
        }

        [data-theme="auto"] .theme-toggle-slider {
            border-color: rgba(212, 175, 55, 0.5);
            box-shadow: 
                0 0 20px rgba(212, 175, 55, 0.5),
                0 0 40px rgba(212, 175, 55, 0.2);
            animation: pulseAuto 2s ease-in-out infinite;
        }

        /* Бейдж режима */
        .theme-badge {
            position: absolute;
            bottom: -8px;
            background: var(--gold);
            color: white;
            font-size: 9px;
            font-weight: 800;
            padding: 2px 6px;
            border-radius: 10px;
            letter-spacing: 0.5px;
            opacity: 0;
            transform: translateY(10px) scale(0.8);
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .premium-theme-toggle:hover .theme-badge {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Эффект при переключении */
        .theme-change-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, var(--gold) 0%, transparent 70%);
            opacity: 0;
            animation: themeChangePulse 0.6s ease-out;
            pointer-events: none;
        }

        /* Анимации */
        @keyframes rotateGradient {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes gentlePulse {
            0%, 100% { 
                opacity: 0.7;
                transform: scale(0.8); 
            }
            50% { 
                opacity: 0.9;
                transform: scale(0.85); 
            }
        }

        @keyframes pulseAuto {
            0%, 100% { 
                box-shadow: 
                    0 0 20px rgba(212, 175, 55, 0.5),
                    0 0 40px rgba(212, 175, 55, 0.2);
            }
            50% { 
                box-shadow: 
                    0 0 25px rgba(212, 175, 55, 0.7),
                    0 0 50px rgba(212, 175, 55, 0.3);
            }
        }

        @keyframes themeChangePulse {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                opacity: 0.3;
                transform: scale(1.2);
            }
            100% {
                opacity: 0;
                transform: scale(1.5);
            }
        }

        /* === БАЗОВЫЕ СТИЛИ === */
        * {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            text-align: center;
            transition: background-color 0.4s ease, color 0.4s ease;
            overflow-x: hidden;
            min-height: 100vh;
            opacity: 1;
        }

        #totalPrice, .total-currency, #l-total { 
            color: var(--gold) !important; 
        }

        #netPrice, #netPrice + .total-currency { 
            color: #2ecc71 !important; 
            font-weight: 800;
        }

        #how, #services, #faq, #zone { 
            scroll-margin-top: 130px; 
        }

        .reveal { 
            opacity: 0; 
            transform: translateY(20px); 
            transition: all 0.6s ease-out; 
        }
        
        .reveal.active { 
            opacity: 1; 
            transform: translateY(0); 
        }

        /* === НАВИГАЦИЯ === */
        .nav-container { 
            position: sticky; 
            top: 0; 
            z-index: 1000; 
            background: var(--nav-bg); 
            padding: 10px 0; 
            border-bottom: 2px solid var(--gold); 
            box-shadow: var(--gold-glow); 
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px);
            transition: background-color 0.4s ease, border-color 0.4s ease; 
        }

        .lang-btn { 
            background: transparent; 
            border: 1.5px solid var(--gold); 
            color: var(--gold); 
            padding: 5px 10px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: 700; 
            margin: 0 2px; 
            transition: 0.3s; 
        }
        
        .lang-btn:hover, .lang-btn.active { 
            background: var(--gold); 
            color: white; 
            box-shadow: 0 0 15px var(--gold);
        }

        .nav-pills { 
            display: flex; 
            justify-content: center; 
            gap: 8px; 
            margin-top: 10px; 
            flex-wrap: wrap; 
        }
        
        .nav-pill { 
            background: rgba(212,175,55,0.1); 
            border: 1px solid var(--gold); 
            color: var(--gold); 
            padding: 5px 10px; 
            border-radius: 20px; 
            text-decoration: none; 
            font-size: 0.7rem; 
            font-weight: 700; 
            text-transform: uppercase; 
            transition: 0.3s; 
        }
        
        .nav-pill:hover { 
            background: var(--gold); 
            color: white; 
            box-shadow: 0 0 15px var(--gold);
            transform: translateY(-2px);
        }

        /* === ЛОГО === */
        .main-logo { 
            width: 140px; 
            height: 140px; 
            border-radius: 50%; 
            margin: 20px auto; 
            border: 3px solid var(--gold); 
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3); 
            display: block; 
            transition: 0.4s; 
        }
        
        .main-logo:hover { 
            transform: scale(1.05); 
            box-shadow: 0 0 25px rgba(212, 175, 55, 0.6); 
        }

        #display-name { 
            color: var(--gold); 
            font-weight: 700; 
            font-size: 1.3rem; 
            font-family: 'Montserrat', sans-serif;
        }

        /* === КНОПКИ МЕССЕНДЖЕРОВ - ЗОЛОТОЕ СВЕЧЕНИЕ === */
        .messenger-wrapper { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 12px; 
            max-width: 420px; 
            margin: 20px auto; 
            padding: 0 15px; 
        }
        
        .msg-btn { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 16px 8px; 
            border-radius: 15px; 
            text-decoration: none; 
            color: white !important; 
            font-weight: 700; 
            font-size: 0.85rem; 
            border: none; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            cursor: pointer; 
            position: relative;
            overflow: hidden;
            gap: 10px;
        }
        
        /* ЗОЛОТОЕ СВЕЧЕНИЕ ПРИ НАВЕДЕНИИ */
        .msg-btn:hover { 
            transform: translateY(-5px) scale(1.03); 
            box-shadow: 0 12px 25px rgba(0,0,0,0.3), 0 0 20px var(--gold); 
            filter: brightness(1.15); 
        }
        
        .msg-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        .msg-btn:hover::after {
            left: 100%;
        }

        .msg-icon {
            font-size: 1.4rem;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
        }

        .wa-btn { 
            grid-column: span 2; 
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); 
        }
        
        .tg-btn { 
            background: linear-gradient(135deg, #0088cc 0%, #005580 100%); 
        }
        
        .call-btn { 
            background: linear-gradient(135deg, #d4af37 0%, #a6892c 100%); 
        }
        
        .mail-btn { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
        }
        
        .save-btn { 
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%); 
        }
        
        .share-btn { 
            grid-column: span 2; 
            background: linear-gradient(135deg, #333 0%, #555 100%); 
            border: 1px solid var(--gold); 
        }

        .payment-methods { 
            grid-column: span 2; 
            margin-top: 8px; 
            font-size: 0.85rem; 
            font-weight: 600; 
            color: var(--gold); 
            padding: 10px;
            background: rgba(212, 175, 55, 0.08);
            border-radius: 10px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            transition: all 0.3s ease;
        }

        .payment-methods:hover {
            box-shadow: 0 0 15px var(--gold);
            transform: translateY(-2px);
        }

        /* === КАРТОЧКИ С ЗОЛОТЫМ СВЕЧЕНИЕМ === */
        .universal-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            max-width: 1200px; 
            margin: 20px auto 40px; 
            padding: 0 20px; 
            align-items: stretch; 
        }
        
        .generic-card { 
            background: var(--card-bg); 
            border: 1.5px solid var(--border-color); 
            border-radius: 20px; 
            padding: 25px; 
            text-align: left; 
            transition: background-color 0.4s ease, border-color 0.4s ease, box-shadow 0.4s ease, transform 0.4s ease; 
            display: flex; 
            flex-direction: column; 
            box-shadow: var(--shadow);
        }
        
        /* ЗОЛОТОЕ СВЕЧЕНИЕ ПРИ НАВЕДЕНИИ НА КАРТОЧКИ */
        .generic-card:hover { 
            transform: translateY(-5px); 
            box-shadow: var(--shadow), 0 0 25px var(--gold);
            border-color: var(--gold-light);
        }
        
        .generic-card h2 { 
            color: var(--gold); 
            margin-top: 0; 
            border-bottom: 1px solid var(--gold); 
            padding-bottom: 10px; 
            font-family: 'Playfair Display', serif; 
            font-size: 1.5rem; 
            transition: all 0.3s ease;
        }

        .generic-card:hover h2 {
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        /* === КАЛЬКУЛЯТОР === */
        .calc-row select, .calc-row input { 
            padding: 12px; 
            border-radius: 8px; 
            border: 2px solid var(--gold); 
            background: var(--input-bg); 
            color: var(--input-color) !important; 
            font-weight: 800; 
            width: 100%; 
            font-size: 1.1rem; 
            outline: none; 
            box-sizing: border-box;
            transition: 0.3s;
            appearance: none; 
            -webkit-appearance: none;
        }
        
        .calc-row select option { 
            background: var(--option-bg); 
            color: var(--gold); 
        }

        .calc-row select:focus, .calc-row input:focus {
            box-shadow: 0 0 10px var(--gold);
            border-color: var(--gold-light);
        }

        /* === СИММЕТРИЧНЫЕ ПЛАВАЮЩИЕ КНОПКИ === */
        .floating-btn {
            position: fixed; 
            z-index: 1100; 
            background: var(--gold); 
            border: none; 
            color: white; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
            box-shadow: var(--fab-shadow); 
            font-size: 1.2rem;
            transition: all 0.3s ease;
            border-radius: 50%;
        }
        
        .floating-btn:hover {
            transform: rotate(30deg) scale(1.1);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3), 0 0 15px var(--gold);
        }

        /* Кнопка QR-кода (слева вверху) - СИММЕТРИЧНА С ТЕМОЙ */
        .qr-toggle { 
            top: 15px; 
            left: 15px; 
            width: 52px; 
            height: 52px; 
        }
        
        /* Кнопка музыки (слева внизу) - СИММЕТРИЧНО */
        .music-toggle { 
            bottom: 20px; 
            left: 20px; 
            width: 52px; 
            height: 52px; 
            z-index: 1101;
        }
        
        /* Анимация вращения для музыки */
        .music-toggle.playing i {
            animation: spin 4s infinite linear;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Кнопка "наверх" (справа внизу) - СИММЕТРИЧНО */
        #backToTop { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            width: 52px; 
            height: 52px; 
            background: var(--gold); 
            color: white; 
            border-radius: 50%; 
            border: none; 
            cursor: pointer; 
            display: none; 
            z-index: 1100; 
            box-shadow: var(--fab-shadow); 
            font-size: 1.5rem; 
            align-items: center; 
            justify-content: center; 
            transition: all 0.3s ease;
        }
        
        #backToTop:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3), 0 0 15px var(--gold);
        }
        
        .price-tag { 
            font-weight: 700; 
            color: var(--gold); 
            margin-top: auto; 
            border-top: 1px dashed var(--border-color); 
            padding-top: 10px; 
            font-size: 0.9rem; 
        }
        
        /* === FAQ === */
        .faq-item { 
            text-align: left; 
            border-bottom: 1px solid var(--border-color); 
            padding: 18px 0; 
            cursor: pointer; 
            transition: all 0.3s ease;
        }
        
        .faq-item:hover {
            background: rgba(212,175,55,0.05);
            border-radius: 10px;
            padding: 18px 10px;
        }
        
        .faq-q { 
            font-weight: 700; 
            color: var(--gold); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        .faq-a { 
            font-size: 0.95rem; 
            margin-top: 12px; 
            display: none; 
            line-height: 1.6; 
            color: var(--text-color); 
        }
        
        /* === ФУТЕР === */
        .footer { 
            padding: 60px 20px; 
            border-top: 1px solid var(--border-color); 
            margin-top: 40px; 
            background: rgba(212, 175, 55, 0.03); 
        }
        
        .footer-name { 
            font-family: 'Playfair Display', serif; 
            font-size: 2.2rem; 
            color: var(--gold); 
            margin-bottom: 10px; 
            display: block; 
            transition: all 0.3s ease;
        }
        
        .footer-name:hover {
            text-shadow: 0 0 15px rgba(212, 175, 55, 0.7);
            transform: scale(1.05);
        }
        
        .gold-text { 
            color: var(--gold) !important; 
            font-weight: 700; 
            margin: 5px 0; 
        }

        /* === МУЗЫКАЛЬНЫЙ ПЛЕЕР === */
        #musicPlayer {
            position: fixed;
            bottom: 80px;
            left: 20px;
            z-index: 1999;
            background: var(--nav-bg);
            border: 1px solid var(--gold);
            border-radius: 20px;
            padding: 12px 15px;
            display: none;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: var(--gold-glow);
            min-width: 180px;
            animation: slideInUp 0.3s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .music-control {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }
        
        #musicToggle {
            background: var(--gold);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        #musicToggle:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px var(--gold);
        }
        
        #musicStatus {
            color: var(--gold);
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .track-buttons {
            margin-top: 8px;
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        .track-btn {
            background: rgba(212,175,55,0.2);
            border: 1px solid var(--gold);
            color: var(--gold);
            border-radius: 10px;
            padding: 4px 8px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .track-btn:hover {
            box-shadow: 0 0 8px var(--gold);
        }
        
        .track-btn.active {
            background: var(--gold);
            color: white;
        }

        /* === АНИМАЦИИ === */
        @keyframes gentle-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.9; transform: scale(1.05); }
        }
        
        .wa-btn .msg-icon, .call-btn .msg-icon {
            animation: gentle-pulse 2s infinite ease-in-out;
        }

        /* === УВЕДОМЛЕНИЯ === */
        #custom-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--gold);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: var(--gold-glow);
            z-index: 9999;
            transform: translateX(150%);
            transition: transform 0.4s ease-out;
            font-weight: 600;
            max-width: 300px;
        }
        
        #custom-notification.show {
            transform: translateX(0);
        }

        /* Эффект волны при клике */
        .wave-effect {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: scale(0);
            animation: wave 0.5s ease-out;
            pointer-events: none;
        }
        
        @keyframes wave {
            to {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* Улучшение для кнопок */
        .msg-btn, button, .nav-pill, .lang-btn {
            position: relative;
            overflow: hidden;
        }

        /* === ОВЕРЛЕЙ С QR-КОДОМ === */
        .qr-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--overlay-bg);
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            animation: fadeIn 0.3s ease-out;
            padding-bottom: calc(20px + env(safe-area-inset-bottom, 0px));
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Карточка QR-кода */
        .qr-sheet {
            background-color: var(--card-bg);
            border-radius: 24px 24px 0 0;
            width: 100%;
            max-width: 500px;
            padding: 24px;
            padding-bottom: calc(24px + env(safe-area-inset-bottom, 0px));
            box-shadow: 0 -4px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(100%);
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes slideUp {
            to { transform: translateY(0); }
        }

        .qr-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .qr-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--gold);
            font-family: 'Montserrat', sans-serif;
        }

        .qr-close {
            width: 36px;
            height: 36px;
            border-radius: 18px;
            background-color: rgba(212, 175, 55, 0.1);
            border: 1px solid var(--gold);
            color: var(--gold);
            font-size: 1.5rem;
            line-height: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .qr-close:active {
            background-color: var(--gold);
            color: white;
        }

        .qr-close:hover {
            box-shadow: 0 0 10px var(--gold);
        }

        .qr-container {
            display: flex;
            justify-content: center;
            padding: 20px;
            margin-bottom: 20px;
            background-color: var(--qr-bg);
            border-radius: 16px;
            border: 2px solid var(--gold);
            transition: all 0.3s ease;
        }

        .qr-container:hover {
            box-shadow: 0 0 20px var(--gold);
        }

        /* Изображение QR-кода */
        .qr-image {
            width: 100%;
            max-width: 200px;
            height: auto;
            border-radius: 5px;
        }

        .qr-description {
            text-align: center;
            color: var(--text-color);
            margin-bottom: 24px;
            font-size: 0.95rem;
            line-height: 1.5;
            padding: 0 10px;
        }

        .qr-share-btn {
            width: 100%;
            padding: 16px;
            background: transparent;
            border: 2px solid var(--gold);
            border-radius: 12px;
            color: var(--gold);
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .qr-share-btn:hover {
            background-color: rgba(212, 175, 55, 0.1);
            box-shadow: 0 0 15px var(--gold);
        }

        /* Адаптация для десктопа */
        @media (min-width: 768px) {
            .qr-sheet {
                border-radius: 24px;
                max-width: 400px;
                animation: scaleUp 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
                transform: scale(0.9);
            }
            
            @keyframes scaleUp {
                to { transform: scale(1); }
            }
            
            .qr-overlay {
                align-items: center;
                justify-content: center;
            }
        }

        /* === АДАПТИВ === */
        @media (max-width: 480px) {
            .main-logo {
                width: 120px;
                height: 120px;
            }
            
            .nav-pills {
                gap: 5px;
            }
            
            .nav-pill {
                padding: 4px 8px;
                font-size: 0.65rem;
            }
            
            .universal-grid {
                grid-template-columns: 1fr;
                padding: 0 15px;
            }
            
            .messenger-wrapper {
                gap: 8px;
                padding: 0 10px;
            }
            
            .msg-btn {
                padding: 14px 6px;
                font-size: 0.75rem;
            }
            
            .msg-icon {
                font-size: 1.2rem;
            }

            #custom-notification {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }

            .floating-btn {
                width: 46px !important;
                height: 46px !important;
                font-size: 1rem;
            }
            
            .premium-theme-toggle {
                width: 46px !important;
                height: 46px !important;
                top: 10px !important;
                right: 10px !important;
            }
            
            .theme-toggle-inner {
                width: 24px;
                height: 24px;
            }
            
            .sun-icon, .moon-icon {
                font-size: 12px;
            }
            
            .theme-badge {
                font-size: 8px;
                padding: 1px 4px;
                bottom: -6px;
            }
            
            .qr-toggle {
                top: 10px;
                left: 10px;
                width: 46px !important;
                height: 46px !important;
            }
            
            .music-toggle {
                bottom: 10px;
                left: 10px;
                width: 46px !important;
                height: 46px !important;
            }
            
            #backToTop {
                bottom: 10px;
                right: 10px;
                width: 46px !important;
                height: 46px !important;
                font-size: 1.3rem;
            }
            
            #musicPlayer {
                bottom: 60px;
                left: 10px;
            }
        }
        
        @media (max-width: 380px) {
            .msg-btn {
                flex-direction: column;
                gap: 5px;
                padding: 12px 5px;
            }
            
            .msg-icon {
                font-size: 1.1rem;
            }
        }
    </style>
    
    <!-- РАННИЙ СКРИПТ ДЛЯ SAFARI - АВТОТЕМА ПО УМОЛЧАНИЮ -->
    <script>
        // ИНИЦИАЛИЗАЦИЯ ТЕМЫ - АВТО РЕЖИМ ПО УМОЛЧАНИЮ
        (function() {
            'use strict';
            
            try {
                const html = document.documentElement;
                const body = document.body;
                
                // Функция для безопасной работы с хранилищем
                const getThemePreference = () => {
                    try {
                        // Сначала проверяем ручной выбор пользователя
                        const saved = localStorage.getItem('theme-preference');
                        if (saved === 'light' || saved === 'dark' || saved === 'auto') {
                            return saved;
                        }
                        
                        // Проверяем cookies как fallback
                        const cookieTheme = document.cookie
                            .split('; ')
                            .find(row => row.startsWith('theme-preference='))
                            ?.split('=')[1];
                        
                        if (cookieTheme === 'light' || cookieTheme === 'dark' || cookieTheme === 'auto') {
                            return cookieTheme;
                        }
                        
                    } catch (e) {
                        // Игнорируем ошибки
                    }
                    
                    // ПО УМОЛЧАНИЮ - АВТО РЕЖИМ
                    return 'auto';
                };
                
                // Функция определения текущей темы для отображения
                const getCurrentTheme = () => {
                    const preference = getThemePreference();
                    
                    if (preference === 'light') return 'light';
                    if (preference === 'dark') return 'dark';
                    
                    // Если 'auto' - определяем по системе
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        return 'dark';
                    }
                    
                    return 'light';
                };
                
                // Функция сохранения предпочтения
                const saveThemePreference = (theme) => {
                    try {
                        localStorage.setItem('theme-preference', theme);
                        document.cookie = `theme-preference=${theme}; path=/; max-age=31536000; SameSite=Lax`;
                    } catch (e) {
                        // Игнорируем ошибки
                    }
                };
                
                // Устанавливаем тему
                const setTheme = (theme) => {
                    html.setAttribute('data-theme', theme);
                    
                    // Обновляем meta теги для Safari
                    const themeColorMeta = document.getElementById('theme-color');
                    const themeColorLightMeta = document.getElementById('theme-color-light');
                    
                    if (theme === 'dark') {
                        if (themeColorMeta) {
                            themeColorMeta.media = 'all';
                            themeColorLightMeta.media = 'not all';
                        }
                    } else {
                        if (themeColorMeta) {
                            themeColorMeta.media = 'not all';
                            themeColorLightMeta.media = 'all';
                        }
                    }
                };
                
                // Инициализация
                try {
                    const preference = getThemePreference();
                    const currentTheme = getCurrentTheme();
                    
                    // Если нет сохраненного предпочтения, сохраняем 'auto' как дефолт
                    if (!preference) {
                        saveThemePreference('auto');
                    }
                    
                    // Устанавливаем тему
                    setTheme(currentTheme);
                    
                    // Плавное появление
                    body.style.opacity = '0';
                    setTimeout(() => {
                        body.style.transition = 'opacity 0.4s ease';
                        body.style.opacity = '1';
                    }, 50);
                    
                } catch (error) {
                    // Fallback - авто режим
                    html.setAttribute('data-theme', 'auto');
                    body.style.opacity = '1';
                }
            } catch (error) {
                // Аварийный fallback - авто режим
                document.documentElement.setAttribute('data-theme', 'auto');
            }
        })();
    </script>
</head>
<body>
    <!-- Кнопка QR-кода (слева вверху) - СИММЕТРИЧНА -->
    <button class="floating-btn qr-toggle" id="qrBtn" aria-label="Показать QR-код">
        <i class="fas fa-qrcode"></i>
    </button>

    <!-- ПРЕМИУМ КНОПКА ТЕМЫ (справа вверху) - СИММЕТРИЧНА -->
    <button class="floating-btn premium-theme-toggle" id="theme-btn" aria-label="Переключить тему">
        <div class="theme-toggle-inner">
            <i class="fas fa-sun sun-icon"></i>
            <i class="fas fa-moon moon-icon"></i>
            <div class="theme-toggle-slider"></div>
        </div>
        <span class="theme-badge" id="theme-badge">AUTO</span>
    </button>

    <!-- Кнопка музыки (слева внизу) - СИММЕТРИЧНА -->
    <button class="floating-btn music-toggle" id="musicBtn" aria-label="Музыка">
        <i class="fas fa-music"></i>
    </button>

    <!-- ОВЕРЛЕЙ С QR-КОДОМ (ИСПРАВЛЕННЫЙ) -->
    <div class="qr-overlay" id="qrOverlay">
        <div class="qr-sheet">
            <div class="qr-header">
                <h3 class="qr-title" id="qrTitle">QR-code de contact</h3>
                <button class="qr-close" id="closeQR" aria-label="Закрыть">×</button>
            </div>
            
            <div class="qr-container">
                <!-- РАБОЧИЙ QR-код с fallback -->
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=https://paulmultiservice.fr&format=png&margin=10&color=0A2E1F&bgcolor=F9F7F2"
                     alt="QR Code Paul MultiService"
                     class="qr-image"
                     id="qrImage"
                     onerror="loadBackupQR()">
            </div>
            
            <p class="qr-description" id="qrDescription">Scannez le QR-code pour enregistrer les coordonnées</p>
            
            <button class="qr-share-btn" id="shareQR">
                <i class="fas fa-share-alt"></i>
                <span id="shareQRText">PARTAGER LE QR-CODE</span>
            </button>
        </div>
    </div>

    <!-- Кнопка "наверх" (справа внизу) - СИММЕТРИЧНА -->
    <button id="backToTop" onclick="scrollToTop()" title="Retour en haut">↑</button>

    <div class="nav-container">
        <button class="lang-btn" id="btn-fr" onclick="changeLang('fr')">FR</button>
        <button class="lang-btn" id="btn-en" onclick="changeLang('en')">EN</button>
        <button class="lang-btn" id="btn-ua" onclick="changeLang('ua')">UA</button>
        <button class="lang-btn" id="btn-ru" onclick="changeLang('ru')">RU</button>
        <div class="nav-pills">
            <a href="#top" class="nav-pill" id="nav-home">Accueil</a>
            <a href="#how" class="nav-pill" id="n-how">Process</a>
            <a href="#services" class="nav-pill" id="n-serv">Services</a>
            <a href="#faq" class="nav-pill" id="n-faq">FAQ</a>
            <a href="#zone" class="nav-pill" id="n-zone">Zone</a>
        </div>
    </div>

    <div class="reveal" id="top">
        <p style="font-family: 'Playfair Display', serif; font-size: 2.5rem; color: var(--gold); margin: 30px 0 0;">PaulMultiService</p>
        <img src="logo.png" alt="Logo" class="main-logo">
        <div id="display-name"></div>
        <div id="sap-info" style="margin-top:10px; color: var(--gold); font-weight: 700; letter-spacing: 1px;"></div>
    </div>

    <div class="messenger-wrapper reveal">
        <a href="#" class="msg-btn wa-btn" id="wa-link" onclick="sendToWhatsApp(event)">
            <i class="msg-icon fab fa-whatsapp"></i>
            <span id="wa-text">WhatsApp</span>
        </a>
        <a href="https://t.me/PaulMultiService_bot" target="_blank" class="msg-btn tg-btn">
            <i class="msg-icon fab fa-telegram-plane"></i>
            <span id="tg-text">Telegram</span>
        </a>
        <a href="tel:+33745625007" class="msg-btn call-btn" id="l-call">
            <i class="msg-icon fas fa-phone-alt"></i>
            <span id="call-text"></span>
        </a>
        <button onclick="copyEmail()" class="msg-btn mail-btn" id="l-mail">
            <i class="msg-icon fas fa-envelope"></i>
            <span id="mail-text"></span>
        </button>
        <button onclick="downloadVCard()" class="msg-btn save-btn" id="l-save">
            <i class="msg-icon fas fa-save"></i>
            <span id="save-text"></span>
        </button>
        <button onclick="shareSite()" class="msg-btn share-btn" id="l-share">
            <i class="msg-icon fas fa-share-alt"></i>
            <span id="share-text"></span>
        </button>
        <div class="payment-methods" id="l-pay"></div>
    </div>

    <h2 id="how-title" class="reveal" style="color: var(--gold); margin-top: 40px; font-family: 'Playfair Display', serif;"></h2>
    <div id="how" class="universal-grid">
        <div class="generic-card reveal"><h2 id="h1-t"></h2><p id="h1-d"></p></div>
        <div class="generic-card reveal"><h2 id="h2-t"></h2><p id="h2-d"></p></div>
        <div class="generic-card reveal"><h2 id="h3-t"></h2><p id="h3-d"></p></div>
    </div>

    <h2 id="serv-calc-title" class="reveal" style="color: var(--gold); margin-top: 60px; font-family: 'Playfair Display', serif;"></h2>

    <div class="universal-grid" id="services">
        <div class="generic-card reveal">
            <h2 id="it-t"></h2>
            <ul id="it-l" style="font-size: 0.95rem; line-height: 1.7; padding-left: 20px;"></ul>
            <div class="price-tag" id="it-p"></div>
        </div>

        <div class="generic-card reveal" style="border: 2px solid var(--gold); background: rgba(212,175,55,0.03);">
            <h2 id="c-t" style="border:none"></h2>
            <div class="calc-row" style="display: flex; flex-direction: column; gap: 10px;">
                <select id="daySelect" onchange="updateCalc()">
                    <option value="1" id="o-wd"></option>
                    <option value="2" id="o-sat"></option>
                    <option value="3" id="o-sun"></option>
                </select>
                <input type="number" id="hoursInput" value="1" min="1" oninput="updateCalc()">
            </div>
            <div style="font-weight: 800; margin: 15px 0; font-size: 1.4rem;">
                <span id="l-total"></span> <span id="totalPrice">50</span><span class="total-currency">€</span>
            </div>
            <div class="price-tag" style="background: rgba(212,175,55,0.1); padding: 10px; border-radius: 10px; border: none;">
                <span id="c-net"></span> <span id="netPrice" style="font-size: 1.6rem;">25</span><span class="total-currency">€</span>
            </div>
        </div>

        <div class="generic-card reveal">
            <h2 id="br-t"></h2>
            <ul id="br-l" style="font-size: 0.95rem; line-height: 1.7; padding-left: 20px;"></ul>
            <div class="price-tag" id="br-p"></div>
        </div>
    </div>

    <div id="faq" class="reveal" style="padding: 20px; max-width: 800px; margin: 40px auto;">
        <h2 id="f-t" style="color:var(--gold); font-family: 'Playfair Display', serif;"></h2>
        <div id="faq-container"></div>
    </div>

    <div id="zone" class="reveal" style="padding: 20px; max-width: 1000px; margin: 40px auto;">
        <h2 id="z-t" style="color:var(--gold); font-family: 'Playfair Display', serif;"></h2>
        <p id="z-desc" style="margin-bottom: 20px; font-weight: 600;"></p>
        <iframe style="width: 100%; height: 350px; border-radius: 20px; border: 2px solid var(--gold);" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d42618.34963503112!2d-1.6881260759082264!3d48.11726591783063!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x480ede3238867f7d%3A0x40ca5cd36e4ab30!2sBetton!5e0!3m2!1sfr!2sfr!4v1715850000000!5m2!1sfr!2sfr" allowfullscreen="" loading="lazy"></iframe>
        <br>
        <a href="https://www.google.com/maps/dir/?api=1&destination=Rennes" target="_blank" class="msg-btn call-btn" id="l-route" style="display:inline-flex; margin-top:20px; width:auto; padding:12px 40px;">
            <i class="msg-icon fas fa-route"></i>
            <span id="route-text"></span>
        </a>
    </div>

    <div class="footer reveal">
        <span class="footer-name" id="f-name"></span>
        <div id="footer-zone-text" style="font-weight: 600; margin-bottom: 15px; font-size: 1.1rem;"></div>
        <p class="gold-text">EI Pavlo Pashkin | SIRET : 10000226000014</p>
        <p class="gold-text">RC Pro incluse</p>
        <p class="gold-text">Service à la Personne (SAP)</p>
        <p style="font-size: 0.8rem; margin-top: 20px; opacity: 0.7;">TVA non applicable, art. 293 B du CGI<br>35700 Rennes</p>
    </div>

    <!-- МУЗЫКАЛЬНЫЙ ПЛЕЕР -->
    <div id="musicPlayer">
        <div class="music-control">
            <button onclick="toggleMusic()" id="musicToggle">▶️</button>
            <span id="musicStatus">Musique off</span>
        </div>
        
        <div class="volume-control">
            <span style="color:var(--gold); font-size:0.8rem;">🔈</span>
            <input type="range" id="volumeControl" min="0" max="1" step="0.05" value="0.15" oninput="changeVolume(this.value)" style="width:100px; accent-color:var(--gold);">
            <span style="color:var(--gold); font-size:0.8rem;">🔊</span>
        </div>
        
        <div class="track-buttons">
            <button onclick="changeTrack('chill')" class="track-btn active" id="trackChill"></button>
            <button onclick="changeTrack('ambient')" class="track-btn" id="trackAmbient"></button>
            <button onclick="changeTrack('corporate')" class="track-btn" id="trackCorporate"></button>
        </div>
    </div>

    <!-- УВЕДОМЛЕНИЯ -->
    <div id="custom-notification"></div>

    <!-- ОСНОВНОЙ СКРИПТ -->
    <script>
        // ===== ПЕРЕВОДЫ =====
        const translations = {
            fr: {
                n_home: "Accueil",
                name: "Paul — Votre artisan", sap: "RÉDUCTION D'IMPÔT 50% (SAP)",
                h_zone: "Zone d'intervention : Rennes & alentours (Betton, Saint-Grégoire, Pacé, Bruz...)",
                n_how: "Étapes", n_serv: "Services", n_faq: "FAQ", n_zone: "Zone",
                l_call: "Appeler", l_mail: "E-mail", l_save: "Enregistrer", l_share: "Partager", l_route: "Itinéraire",
                l_pay: "Espèces / Virement / Chèque / Cesu", how_t: "Comment ça marche ?", sc_t: "Services et calculatrice",
                h1t: "Contact", h1d: "Contactez-moi par WhatsApp ou par téléphone pour discuter de votre projet.",
                h2t: "Tarif", h2d: "1ère heure indivisible (forfait minimum) : 50€. Heures suivantes : 40€/h. Semaine : base. Sамсуди: x2. Dimanche: x3.",
                h3t: "Avantage", h3d: "Bénéficiez de 50% de crédit d'impôt SAP. Facture officielle fournie.",
                it_t: "Web & IT Services", it_l: "<li>Création de sites (Landing, Carte de visite)</li><li>Installation OS & Logiciels</li><li>Nettoyage & Virus</li><li>Paramétrage Wi-Fi & Réseaux</li>",
                it_p: "Forfait min. : 50€<br>Suivante : 40€/h",
                br_t: "Bricolage", br_l: "<li>Montage meubles (IKEA, etc.)</li><li>Installation luminaires, TV, étagères</li><li>Petite plomberie & serrures</li><li>Branchement électroménager</li>",
                br_p: "Forfait min. : 50€<br>Suivante : 40€/h",
                ct: "Simulateur SAP", cnet: "Coût réel (SAP) :", owd: "Semaine", osat: "Samedi (x2)", osun: "Dimanche (x3)", l_total: "Total :",
                zt: "Zone d'intervention", zd: "Rayon de 20 km inclus autour de Rennes (Betton, Saint-Grégoire, Pacé, Bruz...). Au-delà : sur devis.", ft: "Questions fréquentes",
                faq: [
                    {q: "La 1ère heure est-elle toujours à 50€ ?", a: "Oui, la première heure est un forfait minimum indivisible de 50€. Cela couvre le déplacement, la préparation du matériel et l'intervention technique."},
                    {q: "Ai-je besoin d'avoir mes propres outils ?", a: "Non, je viens avec tout mon outillage professionnel. Les consommables (vis, chevilles, joints, câbles, etc.) sont à votre charge.<br><br><b>Service d'achat :</b> Si besoin, je peux me rendre en magasin pour acheter les fournitures à votre place. Ce déplacement est facturé comme une prestation séparée."},
                    {q: "Où obtenir des chèques CESU ?", a: "Sur le site cesu.urssaf.fr ou auprès de votre banque."},
                    {q: "Le SAP fonctionne-t-il le week-end ?", a: "Oui, la réduction d'impôt de 50% s'applique également le samedi et le dimanche."},
                    {q: "Comment fonctionne le remboursement ?", a: "J'émets une facture SAP officielle. L'État vous rembourse 50% via crédit d'impôt lors de votre déclaration annuelle."},
                    {q: "Quels sont les moyens de paiement ?", a: "J'accepte les espèces, les virements, les chèques et les chèques CESU."}
                ],
                msg: "Bonjour Paul! Je vous contacte via votre site pour un devis: ",
                wa_sim: "Simulation",
                music_on: "Musique ON",
                music_off: "Musique OFF",
                track_chill: "Lofi",
                track_ambient: "Ambient",
                track_corporate: "Focus",
                wa_text: "WhatsApp",
                tg_text: "Telegram",
                qr_title: "QR-code de contact",
                qr_desc: "Scannez le QR-code pour enregistrer les coordonnées",
                qr_share: "PARTAGER LE QR-CODE",
                theme_auto: "AUTO",
                theme_light: "CLAIR",
                theme_dark: "SOMBRE",
                theme_auto_notif: "Mode auto activé",
                theme_light_notif: "Mode clair activé",
                theme_dark_notif: "Mode sombre activé"
            },
            ru: {
                n_home: "Главная",
                name: "Павел — Ваш мастер", sap: "НАЛОГОВЫЙ ВЫЧЕТ 50% (SAP)",
                h_zone: "Зона охвата: Rennes и пригород (Betton, Saint-Grégoire, Pacé, Bruz...)",
                n_how: "Процесс", n_serv: "Услуги", n_faq: "Вопросы", n_zone: "Зона",
                l_call: "Позвонить", l_mail: "Почта", l_save: "Сохранить", l_share: "Поделиться", l_route: "Маршрут",
                l_pay: "Наличные / Перевод / Чеки / Cesu", how_t: "Как это работает?", sc_t: "Услуги и калькулятор",
                h1t: "Связь", h1d: "Напишите в WhatsApp или позвоните. Мы обсудим вашу задачу и время визита.",
                h2t: "Тариф", h2d: "Первый час — фиксированный минимум 50€. Далее — 40€/час. Будни: база. Суббота: x2. Воскресенье: x3.",
                h3t: "Выгода", h3d: "Официальная фактура SAP позволяет вернуть 50% затрат через налоговый вычет.",
                it_t: "Web и ИТ услуги", it_l: "<li>Создание сайтов (Landing, Визитка)</li><li>Установка ОС и программ</li><li>Чистка от вирусов</li><li>Настройка Wi-Fi и сетей</li>",
                it_p: "Мин. выезд: 50€<br>След. часы: 40€/ч",
                br_t: "Мастер на час", br_l: "<li>Сборка мебели (IKEA и др.)</li><li>Установка люстр, ТВ, полок</li><li>Мелкая сантехника и замки</li><li>Подключение бытовой техники</li>",
                br_p: "Мин. выезд: 50€<br>След. часы: 40€/ч",
                ct: "Калькулятор SAP", cnet: "Цена с вычетом:", owd: "Будни", osat: "Суббота (x2)", osun: "Воскресенье (x3)", l_total: "Итого:",
                zt: "Зона охвата", zd: "Радиус 20 км вокруг Rennes (Betton, Saint-Grégoire, Pacé, Bruz...) включен. Далее — по договоренности.", ft: "Частые вопросы",
                faq: [
                    {q: "Оплата за первый час всегда 50€?", a: "Да, первый час — это минимальный неделимый тариф (forfait), который покрывает транспортные расходы и подготовку."},
                    {q: "Нужны ли мои инструменты?", a: "Нет, я привожу всё профессиональное оборудование с собой. Расходные материалы (дюбели, винты и т.д.) оплачиваются вами.<br><br><b>Отдельный сервис по закупке:</b> Если чего-то не хватает, я могу съездить в магазин и купить всё необходимое за вас. Эта услуга (поездка в магазин) оплачивается отдельно."},
                    {q: "Где взять чеки CESU?", a: "На сайте cesu.urssaf.fr или в вашем банке."},
                    {q: "Действует ли SAP в выходные?", a: "Да, налоговый вычет 50% сохраняется при работе в субботу и воскресенье."},
                    {q: "Как работает возврат?", a: "Я выдаю официальную фактуру SAP. Государство возвращает вам 50% суммы при подаче ежегодной декларации."},
                    {q: "Как можно оплатить услуги?", a: "Наличные, банковский перевод, чеки или чеки CESU."}
                ],
                msg: "Здравствуйте, Павел! Хочу уточнить стоимость: ",
                wa_sim: "Расчет",
                music_on: "Музыка ON",
                music_off: "Музыка OFF",
                track_chill: "Лофи",
                track_ambient: "Эмбиент",
                track_corporate: "Фокус",
                wa_text: "WhatsApp",
                tg_text: "Telegram",
                qr_title: "QR-код контакта",
                qr_desc: "Отсканируйте QR-код, чтобы сохранить контактные данные",
                qr_share: "ПОДЕЛИТЬСЯ QR-КОДОМ",
                theme_auto: "АВТО",
                theme_light: "СВЕТ",
                theme_dark: "ТЬМА",
                theme_auto_notif: "Авто режим включён",
                theme_light_notif: "Светлый режим включён",
                theme_dark_notif: "Тёмный режим включён"
            },
            ua: {
                n_home: "Головна",
                name: "Павло — Ваш майстер", sap: "ПОДАТКОВА ЗНИЖКА 50% (SAP)",
                h_zone: "Зона охоплення: Rennes та околиці (Betton, Saint-Grégoire, Pacé, Bruz...)",
                n_how: "Процес", n_serv: "Послуги", n_faq: "Питання", n_zone: "Зона",
                l_call: "Дзвінок", l_mail: "Пошта", l_save: "Зберегти", l_share: "Поділитись", l_route: "Маршрут",
                l_pay: "Готівка / Переказ / Чеки / Cesu", how_t: "Як це працює?", sc_t: "Послуги та калькулятор",
                h1t: "Зв'язок", h1d: "Напишіть у WhatsApp або зателефонуйте. Обговоримо вашу задачу та зручний час.",
                h2t: "Тариф", h2d: "Перша година — фіксований мінімум 50€. Наступні години — 40€/год. Будні: база. Суббота: x2. Неділя: x3.",
                h3t: "Вигода", h3d: "Офіційна фактура SAP дозволяє повернути 50% витрат через податковий кредит.",
                it_t: "Web та IT послуги", it_l: "<li>Створення сайтів (Landing, Візитка)</li><li>Встановлення ОС та програм</li><li>Чистка від вірусів</li><li>Налаштування Wi-Fi</li>",
                it_p: "Мін. виїзд: 50€<br>Наст. години: 40€/год",
                br_t: "Майстер на годину", br_l: "<li>Збирання меблів (IKEА та ін.)</li><li>Встановлення люстр, ТВ, полиць</li><li>Дрібна сантехніка та замки</li><li>Підключення побутової техніки</li>",
                br_p: "Мін. виїзд: 50€<br>Наст. години: 40€/год",
                ct: "Калькулятор SAP", cnet: "Ціна зі знижкою:", owd: "Будні", osat: "Субота (x2)", osun: "Неділя (x3)", l_total: "Разом:",
                zt: "Зона охоплення", zd: "Радіус 20 км навколо Rennes (Betton, Saint-Grégoire, Pacé, Bruz...) включено. Далі — за домовленістю.", ft: "Поширені питання",
                faq: [
                    {q: "Оплата за першу годину завжди 50€?", a: "Так, перша година — це мінімальний неподільний тариф, що покриває виїзд та підготовку інструментів."},
                    {q: "Чи потрібні мої інструменти?", a: "Ні, я маю все необхідне професійне обладнання. Витратні матеріали (шурупи, дюбелі тощо) надаються замовником.<br><br><b>Окрема послуга закупівлі:</b> Якщо чогось не вистачає, я можу з'їзити в магазин і купити все необхідне за вас. Ця послуга оплачується окремо."},
                    {q: "Де замовити чеки CESU?", a: "На офіційному сайті cesu.urssaf.fr або у вашому банку."},
                    {q: "Чи діє SAP у вихідні?", a: "Так, податкову знижку 50% діє такос у суботу та неділю."},
                    {q: "Як працює повернення коштів?", a: "Я видаю офіційну фактуру SAP. Держава повертає вам 50% суми під час подання щорічної декларації."},
                    {q: "Які є способи оплати?", a: "Готівка, банківський переказ, чеки або чеки CESU."}
                ],
                msg: "Доброго дня, Павло! Цикавить вартість робіт: ",
                wa_sim: "Розрахунок",
                music_on: "Музика ON",
                music_off: "Музика OFF",
                track_chill: "Лофі",
                track_ambient: "Ембієнт",
                track_corporate: "Фокус",
                wa_text: "WhatsApp",
                tg_text: "Telegram",
                qr_title: "QR-код контакту",
                qr_desc: "Відскануйте QR-код, щоб зберегти контактні дані",
                qr_share: "ПОДІЛИТИСЯ QR-КОДОМ",
                theme_auto: "АВТО",
                theme_light: "СВІТ",
                theme_dark: "ТЕМ",
                theme_auto_notif: "Авто режим увімкнено",
                theme_light_notif: "Світлий режим увімкнено",
                theme_dark_notif: "Темний режим увімкнено"
            },
            en: {
                n_home: "Home",
                name: "Paul — Your Handyman", sap: "50% TAX REDUCTION (SAP)",
                h_zone: "Service Area : Rennes & surroundings (Betton, Saint-Grégoire, Pacé, Bruz...)",
                n_how: "Process", n_serv: "Services", n_faq: "FAQ", n_zone: "Zone",
                l_call: "Call", l_mail: "Email", l_save: "Save", l_share: "Share", l_route: "Route",
                l_pay: "Cash / Transfer / Cheque / Cesu", how_t: "How it works?", sc_t: "Services & Calculator",
                h1t: "Contact", h1d: "Message me on WhatsApp or call to discuss your project and schedule a visit.",
                h2t: "Pricing", h2d: "1st hour is a minimum flat fee of 50€. Next hours: 40€/h. Weekdays: base. Sat: x2. Sun: x3.",
                h3t: "Benefit", h3d: "Official SAP invoice allows you to get 50% back via tax credit.",
                it_t: "Web & IT Services", it_l: "<li>Websites (Landing, Business card)</li><li>OS & Software installation</li><li>Virus removal</li><li>Wi-Fi & Networks</li>",
                it_p: "Min. fee: 50€<br>Next: 40€/h",
                br_t: "Handyman Services", br_l: "<li>Furniture assembly (IKEA, etc.)</li><li>Lights, TV, shelves installation</li><li>Minor plumbing & locks</li><li>Appliance connection</li>",
                br_p: "Min. fee: 50€<br>Next: 40€/h",
                ct: "SAP Calculator", cnet: "Cost after tax credit:", owd: "Weekday", osat: "Saturday (x2)", osun: "Sunday (x3)", l_total: "Total Price:",
                zt: "Service Area", zd: "20 km radius around Rennes (Betton, Saint-Grégoire, Pacé, Bruz...) included. Beyond: by agreement.", ft: "FAQ",
                faq: [
                    {q: "Is the 1st hour always 50€?", a: "Yes, the first hour is a minimum flat rate (forfait) covering travel and tool preparation."},
                    {q: "Do I need to provide tools?", a: "No, I bring all professional tools. Consumables (screws, wall plugs, etc.) are at your expense.<br><br><b>Shopping Service:</b> If needed, I can go to the store and buy supplies for you. This service is charged as a separate intervention."},
                    {q: "Where to get CESU cheques?", a: "At cesu.urssaf.fr or from your bank."},
                    {q: "Does SAP work on weekends?", a: "Yes, the 50% tax credit applies on Saturdays and Sundays too."},
                    {q: "How does the refund work?", a: "I issue a SAP invoice, and the state refunds you 50% via tax credit on your annual return."},
                    {q: "Payment methods?", a: "Cash, bank transfer, bank cheques, and CESU."}
                ],
                msg: "Hello Paul! I need a quote for: ",
                wa_sim: "Quote",
                music_on: "Music ON",
                music_off: "Music OFF",
                track_chill: "Lofi",
                track_ambient: "Ambient",
                track_corporate: "Focus",
                wa_text: "WhatsApp",
                tg_text: "Telegram",
                qr_title: "Contact QR Code",
                qr_desc: "Scan QR code to save contact details",
                qr_share: "SHARE QR CODE",
                theme_auto: "AUTO",
                theme_light: "LIGHT",
                theme_dark: "DARK",
                theme_auto_notif: "Auto mode enabled",
                theme_light_notif: "Light mode enabled",
                theme_dark_notif: "Dark mode enabled"
            }
        };

        // ===== ПРЕМИУМ УПРАВЛЕНИЕ ТЕМОЙ =====
        const themeBtn = document.getElementById('theme-btn');
        const themeBadge = document.getElementById('theme-badge');
        const html = document.documentElement;

        // Три состояния: auto, light, dark
        const themeCycle = ['auto', 'light', 'dark'];

        // Тексты для бейджей на разных языках
        const themeBadgeTexts = {
            fr: { auto: "AUTO", light: "CLAIR", dark: "SOMBRE" },
            en: { auto: "AUTO", light: "LIGHT", dark: "DARK" },
            ru: { auto: "АВТО", light: "СВЕТ", dark: "ТЬМА" },
            ua: { auto: "АВТО", light: "СВІТ", dark: "ТЕМ" }
        };

        // Получение текущего предпочтения
        function getThemePreference() {
            try {
                const saved = localStorage.getItem('theme-preference');
                if (saved === 'light' || saved === 'dark' || saved === 'auto') {
                    return saved;
                }
                
                // Проверяем cookies
                const cookieTheme = document.cookie
                    .split('; ')
                    .find(row => row.startsWith('theme-preference='))
                    ?.split('=')[1];
                
                if (cookieTheme === 'light' || cookieTheme === 'dark' || cookieTheme === 'auto') {
                    return cookieTheme;
                }
            } catch (e) {
                // Игнорируем
            }
            return 'auto';
        }

        // Сохранение предпочтения
        function saveThemePreference(theme) {
            try {
                localStorage.setItem('theme-preference', theme);
                document.cookie = `theme-preference=${theme}; path=/; max-age=31536000; SameSite=Lax`;
            } catch (e) {
                // Игнорируем
            }
        }

        // Определение текущей темы для отображения
        function getCurrentTheme() {
            const preference = getThemePreference();
            
            if (preference === 'light') return 'light';
            if (preference === 'dark') return 'dark';
            
            // Если 'auto' - определяем по системе
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                return 'dark';
            }
            
            return 'light';
        }

        // Создание эффекта переключения
        function createThemeChangeEffect() {
            const effect = document.createElement('div');
            effect.className = 'theme-change-effect';
            themeBtn.appendChild(effect);
            
            setTimeout(() => {
                if (effect.parentNode) {
                    effect.parentNode.removeChild(effect);
                }
            }, 600);
        }

        // Переключение темы
        function toggleTheme() {
            // Создаем эффект
            createThemeChangeEffect();
            
            const currentPreference = getThemePreference();
            
            // Находим следующий режим в цикле
            const currentIndex = themeCycle.indexOf(currentPreference);
            const nextIndex = (currentIndex + 1) % themeCycle.length;
            const nextTheme = themeCycle[nextIndex];
            
            // Сохраняем предпочтение
            saveThemePreference(nextTheme);
            
            // Определяем какую тему показывать
            const themeToShow = nextTheme === 'auto' ? getCurrentTheme() : nextTheme;
            
            // Устанавливаем тему с небольшой задержкой для анимации
            setTimeout(() => {
                html.setAttribute('data-theme', themeToShow);
            }, 150);
            
            // Обновляем кнопку и бейдж
            updateThemeButton(nextTheme);
            
            // Показываем уведомление
            const lang = getCurrentLang();
            const notifications = {
                fr: { auto: "Mode auto activé", light: "Mode clair activé", dark: "Mode sombre activé" },
                en: { auto: "Auto mode enabled", light: "Light mode enabled", dark: "Dark mode enabled" },
                ru: { auto: "Авто режим включён", light: "Светлый режим включён", dark: "Тёмный режим включён" },
                ua: { auto: "Авто режим увімкнено", light: "Світлий режим увімкнено", dark: "Темний режим увімкнено" }
            };
            
            const t = notifications[lang] || notifications.fr;
            showNotification(`🎨 ${t[nextTheme]}`);
        }

        // Обновление кнопки и бейджа
        function updateThemeButton(preference) {
            if (themeBtn && themeBadge) {
                // Устанавливаем data-атрибут для CSS
                themeBtn.setAttribute('data-theme', preference);
                
                // Обновляем бейдж
                const lang = getCurrentLang();
                const texts = themeBadgeTexts[lang] || themeBadgeTexts.fr;
                themeBadge.textContent = texts[preference];
                
                // Меняем title
                const titles = {
                    fr: { auto: "Mode auto", light: "Mode clair", dark: "Mode sombre" },
                    en: { auto: "Auto mode", light: "Light mode", dark: "Dark mode" },
                    ru: { auto: "Авто режим", light: "Светлый режим", dark: "Тёмный режим" },
                    ua: { auto: "Авто режим", light: "Світлий режим", dark: "Темний режим" }
                };
                
                const t = titles[lang] || titles.fr;
                themeBtn.title = t[preference];
                themeBtn.setAttribute('aria-label', t[preference]);
            }
        }

        // Настройка отслеживания системной темы
        function setupSystemThemeListener() {
            if (window.matchMedia) {
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                
                const handleChange = (e) => {
                    const preference = getThemePreference();
                    
                    // Если выбран режим 'auto', меняем тему автоматически
                    if (preference === 'auto') {
                        const newTheme = e.matches ? 'dark' : 'light';
                        html.setAttribute('data-theme', newTheme);
                        
                        // Обновляем кнопку
                        updateThemeButton('auto');
                    }
                };
                
                // Современный способ
                if (mediaQuery.addEventListener) {
                    mediaQuery.addEventListener('change', handleChange);
                } else {
                    // Для старых браузеров
                    mediaQuery.addListener(handleChange);
                }
            }
        }

        // Инициализация темы
        function initTheme() {
            const preference = getThemePreference();
            const currentTheme = getCurrentTheme();
            
            html.setAttribute('data-theme', currentTheme);
            updateThemeButton(preference);
            setupSystemThemeListener();
        }

        // ===== УПРАВЛЕНИЕ QR-КОДОМ (ИСПРАВЛЕННОЕ) =====
        const qrBtn = document.getElementById('qrBtn');
        const qrOverlay = document.getElementById('qrOverlay');
        const closeQR = document.getElementById('closeQR');
        const shareQR = document.getElementById('shareQR');

        qrBtn.addEventListener('click', () => {
            qrOverlay.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            setTimeout(() => {
                qrOverlay.style.opacity = '1';
            }, 10);
        });

        function closeQROverlay() {
            qrOverlay.style.opacity = '0';
            setTimeout(() => {
                qrOverlay.style.display = 'none';
                document.body.style.overflow = '';
            }, 300);
        }

        closeQR.addEventListener('click', closeQROverlay);
        
        qrOverlay.addEventListener('click', (e) => {
            if (e.target === qrOverlay) {
                closeQROverlay();
            }
        });

        // Функция загрузки резервного QR-кода
        function loadBackupQR() {
            const qrImage = document.getElementById('qrImage');
            if (qrImage) {
                // Переключаемся на резервный сервис
                qrImage.src = 'https://quickchart.io/qr?text=https://paulmultiservice.fr&size=250&format=png&margin=10';
                qrImage.onerror = function() {
                    // Если и это не работает, показываем текст
                    this.style.display = 'none';
                    const container = this.parentElement;
                    const fallbackText = document.createElement('div');
                    fallbackText.style.color = 'var(--gold)';
                    fallbackText.style.fontWeight = 'bold';
                    fallbackText.style.padding = '20px';
                    fallbackText.style.fontSize = '1.2rem';
                    fallbackText.textContent = 'paulmultiservice.fr';
                    container.appendChild(fallbackText);
                };
            }
        }

        // Функция поделиться QR-кодом
        shareQR.addEventListener('click', async () => {
            try {
                const lang = getCurrentLang();
                const t = translations[lang] || translations.fr;
                
                if (navigator.share) {
                    await navigator.share({
                        title: 'Paul MultiService',
                        text: t.qr_desc,
                        url: 'https://paulmultiservice.fr',
                    });
                } else {
                    const qrImage = document.getElementById('qrImage');
                    if (qrImage && qrImage.src) {
                        // Создаем временную ссылку для скачивания
                        const link = document.createElement('a');
                        link.href = qrImage.src;
                        link.download = 'paul-multiservice-qr.png';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        showNotification("✅ QR-код скачан!");
                    } else {
                        // Копируем ссылку в буфер
                        await navigator.clipboard.writeText('https://paulmultiservice.fr');
                        showNotification("✅ Ссылка скопирована!");
                    }
                }
            } catch (err) {
                // Пользователь отменил шаринг
                console.log('Share cancelled:', err);
            }
        });

        // ===== УПРАВЛЕНИЕ МУЗЫКОЙ (ИСПРАВЛЕННОЕ) =====
        let bgMusic = null;
        let isMusicPlaying = false;
        let isMusicPanelVisible = false;
        let currentTrack = 'chill';

        function initAudio() {
            if (bgMusic) return;
            
            try {
                const musicTracks = {
                    chill: 'https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112778.mp3',
                    ambient: 'https://cdn.pixabay.com/download/audio/2024/10/17/audio_74b9006f8c.mp3?filename=calm-piano-inspiring-251916.mp3',
                    corporate: 'https://cdn.pixabay.com/download/audio/2022/01/18/audio_d0a13f69d2.mp3?filename=corporate-technology-11273.mp3'
                };
                
                // Проверяем доступность треков
                const trackUrl = musicTracks[currentTrack];
                if (!trackUrl) {
                    console.warn('Track not found:', currentTrack);
                    return;
                }
                
                bgMusic = new Audio(trackUrl);
                bgMusic.loop = true;
                bgMusic.volume = 0.15;
                bgMusic.preload = 'auto';
                bgMusic.muted = false;
                
                console.log('Audio initialized with track:', currentTrack);
            } catch (e) {
                console.error('Audio init error:', e);
            }
        }

        function attemptAutoPlay() {
            const musicDisabled = localStorage.getItem('musicDisabled') === 'true';
            if (musicDisabled) return;
            
            if (!bgMusic) initAudio();
            if (!bgMusic) return;
            
            // Настраиваем аудио перед попыткой воспроизведения
            bgMusic.muted = false;
            bgMusic.volume = parseFloat(localStorage.getItem('musicVolume') || '0.15');
            
            const playPromise = bgMusic.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    isMusicPlaying = true;
                    updateMusicUI(true);
                    document.getElementById('musicBtn').classList.add('playing');
                    console.log('Music autoplay success');
                }).catch(error => {
                    console.log('Autoplay blocked, waiting for user interaction');
                    // Ждем клика пользователя
                    const playOnInteraction = () => {
                        if (!isMusicPlaying && bgMusic) {
                            bgMusic.play().then(() => {
                                isMusicPlaying = true;
                                updateMusicUI(true);
                                document.getElementById('musicBtn').classList.add('playing');
                                console.log('Music started after interaction');
                            }).catch(e => {
                                console.error('Play after interaction failed:', e);
                            });
                        }
                    };
                    
                    // Добавляем обработчик на клик по всему документу
                    document.addEventListener('click', playOnInteraction, { once: true });
                    
                    // Также добавляем на саму кнопку музыки
                    const musicBtn = document.getElementById('musicBtn');
                    if (musicBtn) {
                        musicBtn.addEventListener('click', playOnInteraction, { once: true });
                    }
                });
            }
        }

        function updateMusicUI(playing) {
            const lang = getCurrentLang();
            const t = translations[lang] || translations.fr;
            const musicToggle = document.getElementById('musicToggle');
            const musicStatus = document.getElementById('musicStatus');
            const musicBtn = document.getElementById('musicBtn');
            
            if (playing) {
                if (musicToggle) musicToggle.innerHTML = '⏸️';
                if (musicStatus) musicStatus.textContent = t.music_on;
                if (musicBtn) musicBtn.classList.add('playing');
            } else {
                if (musicToggle) musicToggle.innerHTML = '▶️';
                if (musicStatus) musicStatus.textContent = t.music_off;
                if (musicBtn) musicBtn.classList.remove('playing');
            }
        }

        function toggleMusicPanel() {
            const panel = document.getElementById('musicPlayer');
            if (!panel) return;
            
            isMusicPanelVisible = !isMusicPanelVisible;
            panel.style.display = isMusicPanelVisible ? 'block' : 'none';
            
            if (!bgMusic) {
                initAudio();
            }
        }

        function toggleMusic() {
            if (!bgMusic) {
                initAudio();
            }
            
            if (!bgMusic) {
                showNotification("🎵 Музыка временно недоступна");
                return;
            }
            
            if (!isMusicPlaying) {
                // Убеждаемся что не muted и есть громкость
                bgMusic.muted = false;
                bgMusic.volume = parseFloat(localStorage.getItem('musicVolume') || '0.15');
                
                const playPromise = bgMusic.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        isMusicPlaying = true;
                        updateMusicUI(true);
                        localStorage.setItem('musicDisabled', 'false');
                        console.log('Music started successfully');
                    }).catch(error => {
                        console.error('Play error:', error);
                        showNotification("🔊 Нажмите еще раз для включения музыки");
                    });
                }
            } else {
                bgMusic.pause();
                isMusicPlaying = false;
                updateMusicUI(false);
                localStorage.setItem('musicDisabled', 'true');
            }
            
            // Не закрываем панель при переключении музыки!
            // Панель остается открытой, если была открыта
        }

        function changeVolume(value) {
            if (!bgMusic) {
                initAudio();
            }
            if (bgMusic) {
                const volume = parseFloat(value);
                bgMusic.volume = volume;
                localStorage.setItem('musicVolume', value);
                
                // Если музыка выключена, включаем ее при изменении громкости
                if (!isMusicPlaying && volume > 0) {
                    bgMusic.muted = false;
                    const playPromise = bgMusic.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            isMusicPlaying = true;
                            updateMusicUI(true);
                        }).catch(e => {});
                    }
                }
            }
        }

        function changeTrack(track) {
            const musicTracks = {
                chill: 'https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112778.mp3',
                ambient: 'https://cdn.pixabay.com/download/audio/2024/10/17/audio_74b9006f8c.mp3?filename=calm-piano-inspiring-251916.mp3',
                corporate: 'https://cdn.pixabay.com/download/audio/2022/01/18/audio_d0a13f69d2.mp3?filename=corporate-technology-11273.mp3'
            };
            
            if (!musicTracks[track]) {
                console.warn('Invalid track:', track);
                return;
            }
            
            const wasPlaying = isMusicPlaying;
            currentTrack = track;
            
            if (bgMusic) {
                if (wasPlaying) {
                    bgMusic.pause();
                }
            }
            
            // Создаем новый Audio объект
            bgMusic = new Audio(musicTracks[track]);
            bgMusic.loop = true;
            bgMusic.volume = parseFloat(localStorage.getItem('musicVolume') || '0.15');
            bgMusic.preload = 'auto';
            bgMusic.muted = false;
            
            document.querySelectorAll('.track-btn').forEach(btn => btn.classList.remove('active'));
            const trackBtn = document.getElementById('track' + track.charAt(0).toUpperCase() + track.slice(1));
            if (trackBtn) trackBtn.classList.add('active');
            
            localStorage.setItem('musicTrack', track);
            
            if (wasPlaying) {
                bgMusic.play().then(() => {
                    console.log('Track changed to:', track);
                }).catch(e => {
                    console.error('Track change play error:', e);
                    // Если не удалось воспроизвести, показываем уведомление
                    showNotification("🔊 Нажмите кнопку воспроизведения");
                });
            }
        }

        function loadMusicSettings() {
            const volume = localStorage.getItem('musicVolume') || '0.15';
            const track = localStorage.getItem('musicTrack') || 'chill';
            const disabled = localStorage.getItem('musicDisabled') === 'true';

            const volumeControl = document.getElementById('volumeControl');
            if (volumeControl) {
                volumeControl.value = volume;
            }

            const musicTracks = {
                chill: 'https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3?filename=lofi-study-112778.mp3',
                ambient: 'https://cdn.pixabay.com/download/audio/2024/10/17/audio_74b9006f8c.mp3?filename=calm-piano-inspiring-251916.mp3',
                corporate: 'https://cdn.pixabay.com/download/audio/2022/01/18/audio_d0a13f69d2.mp3?filename=corporate-technology-11273.mp3'
            };

            if (track && musicTracks[track]) {
                currentTrack = track;
            }
            
            document.querySelectorAll('.track-btn').forEach(btn => btn.classList.remove('active'));
            const trackBtn = document.getElementById('track' + currentTrack.charAt(0).toUpperCase() + currentTrack.slice(1));
            if (trackBtn) trackBtn.classList.add('active');

            const lang = getCurrentLang();
            const t = translations[lang] || translations.fr;
            const trackChill = document.getElementById('trackChill');
            const trackAmbient = document.getElementById('trackAmbient');
            const trackCorporate = document.getElementById('trackCorporate');
            if (trackChill) trackChill.textContent = t.track_chill;
            if (trackAmbient) trackAmbient.textContent = t.track_ambient;
            if (trackCorporate) trackCorporate.textContent = t.track_corporate;
            
            // Обновляем UI музыки
            updateMusicUI(false);
            
            // Если музыка не отключена, пытаемся автовоспроизведение
            if (!disabled) {
                setTimeout(attemptAutoPlay, 1500);
            }
        }

        document.addEventListener('visibilitychange', function() {
            if (bgMusic && isMusicPlaying) {
                if (document.hidden) {
                    bgMusic.pause();
                } else {
                    bgMusic.play().catch(e => {
                        // Если не удалось возобновить, сбрасываем флаг
                        isMusicPlaying = false;
                        updateMusicUI(false);
                    });
                }
            }
        });

        // ===== УВЕДОМЛЕНИЯ =====
        function showNotification(message, duration = 3000) {
            let notification = document.getElementById('custom-notification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'custom-notification';
                document.body.appendChild(notification);
            }
            
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        // ===== ЭФФЕКТ ВОЛНЫ =====
        document.addEventListener('click', function(e) {
            if (e.target.matches('button, .msg-btn, .nav-pill, .lang-btn, .faq-item, .floating-btn, .qr-close, .qr-share-btn, #musicToggle, .track-btn')) {
                const target = e.target;
                const rect = target.getBoundingClientRect();
                
                const wave = document.createElement('span');
                wave.classList.add('wave-effect');
                wave.style.width = Math.max(rect.width, rect.height) + 'px';
                wave.style.height = wave.style.width;
                wave.style.left = e.clientX - rect.left - parseInt(wave.style.width)/2 + 'px';
                wave.style.top = e.clientY - rect.top - parseInt(wave.style.height)/2 + 'px';
                
                target.appendChild(wave);
                
                setTimeout(() => {
                    if (wave.parentNode) {
                        wave.parentNode.removeChild(wave);
                    }
                }, 500);
            }
        });

        // ===== ОСНОВНЫЕ ФУНКЦИИ =====
        function getCurrentLang() {
            try {
                const activeBtn = document.querySelector('.lang-btn.active');
                return activeBtn ? activeBtn.id.replace('btn-', '') : 'fr';
            } catch (e) {
                return 'fr';
            }
        }

        function changeLang(lang) {
            const t = translations[lang] || translations['fr'];
            
            document.querySelectorAll('.lang-btn').forEach(b => {
                b.classList.toggle('active', b.id === 'btn-' + lang);
            });
            
            document.documentElement.lang = lang === 'ua' ? 'uk' : lang;
            
            const setText = (id, text) => {
                const el = document.getElementById(id);
                if (el) el.innerText = text;
            };
            const setHTML = (id, html) => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = html;
            };

            setText('nav-home', t.n_home);
            setText('display-name', t.name);
            setText('f-name', t.name);
            setText('sap-info', t.sap);
            setText('footer-zone-text', t.h_zone);
            setText('n-how', t.n_how);
            setText('n-serv', t.n_serv);
            setText('n-faq', t.n_faq);
            setText('n-zone', t.n_zone);
            
            setText('call-text', t.l_call);
            setText('mail-text', t.l_mail);
            setText('save-text', t.l_save);
            setText('share-text', t.l_share);
            setText('route-text', t.l_route);
            
            if (t.wa_text) setText('wa-text', t.wa_text);
            if (t.tg_text) setText('tg-text', t.tg_text);
            
            setText('l-pay', t.l_pay);
            setText('l-total', t.l_total);
            setText('how-title', t.how_t);
            setText('serv-calc-title', t.sc_t);
            setText('h1-t', t.h1t); 
            setText('h1-d', t.h1d);
            setText('h2-t', t.h2t); 
            setText('h2-d', t.h2d);
            setText('h3-t', t.h3t); 
            setText('h3-d', t.h3d);
            setText('it-t', t.it_t); 
            setHTML('it-l', t.it_l); 
            setHTML('it-p', t.it_p);
            setText('br-t', t.br_t); 
            setHTML('br-l', t.br_l); 
            setHTML('br-p', t.br_p);
            setText('c-t', t.ct); 
            setText('c-net', t.cnet);
            setText('o-wd', t.owd); 
            setText('o-sat', t.osat); 
            setText('o-sun', t.osun);
            setText('f-t', t.ft); 
            setText('z-t', t.zt); 
            setText('z-desc', t.zd);
            
            setText('qrTitle', t.qr_title);
            setText('qrDescription', t.qr_desc);
            setText('shareQRText', t.qr_share);
            
            // Обновляем бейдж темы
            const preference = getThemePreference();
            const badgeTexts = themeBadgeTexts[lang] || themeBadgeTexts.fr;
            setText('theme-badge', badgeTexts[preference]);
            
            const musicStatus = document.getElementById('musicStatus');
            if (musicStatus && t.music_on && t.music_off) {
                musicStatus.textContent = isMusicPlaying ? t.music_on : t.music_off;
            }

            const trackChill = document.getElementById('trackChill');
            const trackAmbient = document.getElementById('trackAmbient');
            const trackCorporate = document.getElementById('trackCorporate');
            if (trackChill) trackChill.textContent = t.track_chill;
            if (trackAmbient) trackAmbient.textContent = t.track_ambient;
            if (trackCorporate) trackCorporate.textContent = t.track_corporate;
            
            const faqBox = document.getElementById('faq-container'); 
            if (faqBox) {
                faqBox.innerHTML = '';
                if (t.faq && Array.isArray(t.faq)) {
                    t.faq.forEach(item => { 
                        const faqEntry = `<div class="faq-item" onclick="toggleFaq(this)"><div class="faq-q">${item.q} <span>+</span></div><div class="faq-a">${item.a}</div></div>`;
                        faqBox.innerHTML += faqEntry; 
                    });
                }
            }
            
            updateCalc();
        }
        
        function updateCalc() { 
            const hoursInput = document.getElementById('hoursInput');
            const daySelect = document.getElementById('daySelect');
            const totalEl = document.getElementById('totalPrice');
            const netEl = document.getElementById('netPrice');

            if (!hoursInput || !daySelect || !totalEl || !netEl) return;

            const h = Math.max(1, parseInt(hoursInput.value) || 1); 
            const m = parseFloat(daySelect.value) || 1; 
            const calculatedTotal = (50 + (h - 1) * 40) * m; 
            
            totalEl.innerText = calculatedTotal; 
            netEl.innerText = Math.round(calculatedTotal / 2); 
        }

        function toggleFaq(el) { 
            if (!el) return;
            const a = el.querySelector('.faq-a'); 
            const s = el.querySelector('span'); 
            if (!a || !s) return;
            const isOpen = a.style.display === 'block'; 
            a.style.display = isOpen ? 'none' : 'block'; 
            s.innerText = isOpen ? '+' : '−'; 
        }

        function sendToWhatsApp(event) {
            if (event) event.preventDefault();
            
            const hoursInput = document.getElementById('hoursInput');
            const totalEl = document.getElementById('totalPrice');
            const daySelect = document.getElementById('daySelect');
            
            if (!hoursInput || !totalEl || !daySelect) return;
            
            const h = Math.max(1, parseInt(hoursInput.value) || 1);
            const total = totalEl.innerText;
            const lang = getCurrentLang();
            const t = translations[lang] || translations.fr;
            
            const dayText = daySelect.options[daySelect.selectedIndex] ? 
                daySelect.options[daySelect.selectedIndex].text : '';
            
            const message = (t.msg || 'Hello! ') + (t.wa_sim || 'Quote') + ': ' + h + 'h, ' + dayText + ' = ' + total + 'EUR';
            
            const phone = '33745625007';
            const url = 'https://api.whatsapp.com/send?phone=' + phone + '&text=' + encodeURIComponent(message);
            
            window.open(url, '_blank');
        }
        
        function scrollToTop() { 
            try {
                window.scrollTo({top: 0, behavior: 'smooth'}); 
            } catch (e) {
                window.scrollTo(0, 0);
            }
        }

        window.onscroll = function() {
            const upBtn = document.getElementById("backToTop");
            if (!upBtn) return;
            const scrollTop = document.body.scrollTop || document.documentElement.scrollTop || 0;
            const scrolled = scrollTop > 300;
            upBtn.style.display = scrolled ? "flex" : "none";
        };

        function copyEmail() { 
            const email = "contact@paulmultiservice.fr";
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(email).then(() => {
                    showNotification("✅ Email copié !");
                }).catch(() => {
                    const textarea = document.createElement('textarea');
                    textarea.value = email;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    showNotification("✅ Email copié !");
                });
            } else {
                const textarea = document.createElement('textarea');
                textarea.value = email;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showNotification("✅ Email copié !");
            }
        }
        
        function shareSite() { 
            const lang = getCurrentLang();
            const t = translations[lang] || translations.fr;
            
            if (navigator.share) { 
                navigator.share({
                    title: 'Paul Multiservice',
                    text: 'Découvrez les services de Paul - Artisan Multiservice',
                    url: window.location.href
                }).catch(() => {}); 
            } else {
                navigator.clipboard.writeText(window.location.href).then(() => {
                    showNotification("✅ Lien copié !");
                });
            }
        }

        function downloadVCard() { 
            try {
                const cardData = "BEGIN:VCARD\nVERSION:3.0\nFN:Paul Multiservice\nTEL:+33745625007\nEMAIL:contact@paulmultiservice.fr\nURL:https://paulmultiservice.fr\nEND:VCARD"; 
                const blob = new Blob([cardData], {type: "text/vcard;charset=utf-8"}); 
                const vUrl = window.URL.createObjectURL(blob); 
                const downloadLink = document.createElement("a"); 
                downloadLink.href = vUrl; 
                downloadLink.download = "Paul_Artisan.vcf"; 
                document.body.appendChild(downloadLink); 
                downloadLink.click(); 
                setTimeout(() => { 
                    if (downloadLink.parentNode) {
                        document.body.removeChild(downloadLink); 
                    }
                    window.URL.revokeObjectURL(vUrl); 
                }, 200);
                
                showNotification("✅ Contact sauvegardé !");
            } catch (e) {
                showNotification("❌ Erreur");
            }
        }
        
        function revealSections() { 
            const reveals = document.querySelectorAll(".reveal"); 
            const h = window.innerHeight || document.documentElement.clientHeight;
            reveals.forEach(el => {
                const rect = el.getBoundingClientRect();
                if (rect.top < h - 100) {
                    el.classList.add("active"); 
                }
            });
        }
        
        window.addEventListener("scroll", revealSections);
        
        // ===== ИНИЦИАЛИЗАЦИЯ =====
        window.addEventListener('DOMContentLoaded', () => { 
            try {
                // Инициализация премиум темы (Auto по умолчанию)
                initTheme();
                
                // Добавляем обработчик клика для кнопки темы
                if (themeBtn) {
                    themeBtn.addEventListener('click', toggleTheme);
                }
                
                // Обработчик для кнопки музыки - открывает/закрывает панель
                const musicBtn = document.getElementById('musicBtn');
                if (musicBtn) {
                    musicBtn.addEventListener('click', toggleMusicPanel);
                }
                
                changeLang('fr'); 
                revealSections(); 
                
                // Инициализация музыки с задержкой
                setTimeout(() => {
                    loadMusicSettings();
                }, 1000);
                
                // Инициализация калькулятора
                updateCalc();
                
                // Проверка всех элементов интерфейса
                console.log('Site initialized successfully');
                console.log('Theme:', getThemePreference());
                console.log('Music system ready');
                console.log('QR system ready');
                
            } catch (error) {
                console.error('Initialization error:', error);
            }
        });
    </script>
</body>
</html>